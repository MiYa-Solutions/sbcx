<div class="well well_job_show well_job_history">
  <!--Billing Summary-->

  <div class="smart_label">
    <ul>
      <li><h1><%= I18n.t('general.general.billing_summary').html_safe %></h1></li>
      <li>
        <% if @service_call.work_done? %>
            <h2><strong> <%= t('general.general.my_profit').html_safe %></strong></h2>
            <% if @service_call.try(:my_profit) < 0 %>
                <span class="negative"><%= humanized_money_with_symbol @service_call.my_profit %></span>
            <% else %>
                <% if @service_call.try(:my_profit) > 0 %>
                    <span class="positive"><%= humanized_money_with_symbol @service_call.my_profit %></span>
                <% else %>
                    <span class="balanced"><%= humanized_money_with_symbol @service_call.my_profit %></span>
                <% end %>

            <% end %>
        <% end %>

      </li>
      <li>
        <%= button_tag Invoice.model_name.human.pluralize, :class => 'btn btn-primary',
                       id:                                        'show_invoices_button', data: { toggle: "collapse", target: "#job_invoices" } if invoice_allowed? %>

        <% unless @service_call.my_role == :subcon || @service_call.my_role == :broker %>
            <%= button_tag t('general.general.receipts'), :class => 'btn btn-primary',
                           id:                                   'show_receipt_button', data: { toggle: "collapse", target: "#job_receipts" } if invoice_allowed? %>
        <% end %>
      </li>
    </ul>
  </div>


  <!--<div id="add_entry" class="collapse">-->
  <!--<#%= render 'accounting_entries/in_line_form', account: current_user.organization.account_for(@service_call.provider) %>-->
  <!--</div>-->

  <div class="row-fluid job_billing_summary">

    <div class="span8 job_billing_summary_table">

      <!--General Summary-->
      <table class="table table-striped table-condensed table-sbcx customer_balance">
        <tbody>

        <!-- Balance-->
        <% case @service_call.my_role when :subcon %>
            <%= render 'provider_balance' %>
        <% when :broker %>
            <%= render 'provider_balance' %>
        <% else %>

        <% end %>


        </tbody>
      </table>

    </div>

  </div>

  <div class="row-fluid">
    <div id="job-billing-component"
         data-customer-comp="<%= {
                                     account: @service_call.customer_account.id,
                                     name:    @service_call.customer.name,
                                     actions: @service_call.user_billing_events,
                                     status:  @service_call.billing_status

                                 }.to_json %>"
         <% if @service_call.subcontractor_id %>
         data-subcon-comp="<%= {
                                   account: @service_call.subcon_account.id,
                                   name:    @service_call.subcontractor.name,
                                   actions: @service_call.subcontractor_status_events,
                                   status:  @service_call.subcontractor_status

                               }.to_json %>"
         <% end %>
         <% if @service_call.my_role != :prov %>
         data-prov-comp="<%= {
                                   account: @service_call.provider_account.id,
                                   name:    @service_call.provider.name,
                                   actions: @service_call.provider_status_events,
                                   status:  @service_call.provider_status

                               }.to_json %>"
         <% end %>

         data-job-id="<%= @service_call.id %>"
         data-org-id="<%= @org.id %>"
         data-subcon-name="<%= @service_call.subcontractor.try(:name) %>"
         data-customer-name="<%= @service_call.customer.name %>"
         data-subcon-actions="<%= @service_call.subcontractor_status_events.to_json %>"
         data-actions="<%= @service_call.status_events.to_json %>"
         data-status="<%= @service_call.status %>"
         data-work-status="<%= @service_call.work_status %>"
         data-entries="<%= ActiveModel::ArraySerializer.new(@service_call.entries.all, each_serializer: AccountingEntrySerializer).to_json %>">


    </div>

  </div>


  <!-- Entries -->
  <%= render 'job_invoices' if invoice_allowed? %>
  <%= render 'job_receipts' %>


  <% case @service_call.my_role when :subcon %>
      <%= render 'provider_entries' %>
  <% when :broker %>
      <%= render 'provider_entries' %>
      <%= render 'subcon_entries' %>
  <% else %>
      <%= render 'subcon_entries' unless @service_call.subcon_na? %>
  <% end %>

  <%= render 'job_boms' %>


</div>
